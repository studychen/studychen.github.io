<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android 新闻客户端基于 ViewPager 实现轮播图片 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言新闻 App 首页最上方一般会循环播放热点图片，如下图所示。

本文主要介绍了利用 ViewPager 实现轮播图片，图片下方加上小圆点指示器标记当前位置，并利用 Timer+Handler 实现了自动轮播播放。
本文链接 http://www.alijava.com/viewpager-photos/ 转载请注明出处
ViewPager展示图片xml 布局123456789101112131">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 新闻客户端基于 ViewPager 实现轮播图片">
<meta property="og:url" content="http://yoursite.com/2016/08/24/viewpager-photos/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言新闻 App 首页最上方一般会循环播放热点图片，如下图所示。

本文主要介绍了利用 ViewPager 实现轮播图片，图片下方加上小圆点指示器标记当前位置，并利用 Timer+Handler 实现了自动轮播播放。
本文链接 http://www.alijava.com/viewpager-photos/ 转载请注明出处
ViewPager展示图片xml 布局123456789101112131">
<meta property="og:image" content="http://img.blog.csdn.net/20160117162640833">
<meta property="og:image" content="http://img.blog.csdn.net/20160116201446285">
<meta property="og:image" content="http://img.blog.csdn.net/20160117164201413">
<meta property="og:image" content="http://img.blog.csdn.net/20160117172421660">
<meta property="og:updated_time" content="2017-02-09T12:48:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 新闻客户端基于 ViewPager 实现轮播图片">
<meta name="twitter:description" content="前言新闻 App 首页最上方一般会循环播放热点图片，如下图所示。

本文主要介绍了利用 ViewPager 实现轮播图片，图片下方加上小圆点指示器标记当前位置，并利用 Timer+Handler 实现了自动轮播播放。
本文链接 http://www.alijava.com/viewpager-photos/ 转载请注明出处
ViewPager展示图片xml 布局123456789101112131">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160117162640833">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-viewpager-photos" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/24/viewpager-photos/" class="article-date">
  <time datetime="2016-08-24T11:22:32.000Z" itemprop="datePublished">2016-08-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android 新闻客户端基于 ViewPager 实现轮播图片
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>新闻 App 首页最上方一般会循环播放热点图片，如下图所示。</p>
<p><img src="http://img.blog.csdn.net/20160117162640833" alt="http://blog.csdn.net/never_cxb"></p>
<p>本文主要介绍了利用 ViewPager 实现轮播图片，图片下方加上小圆点指示器标记当前位置，并利用 Timer+Handler 实现了自动轮播播放。</p>
<p>本文链接 <a href="http://www.alijava.com/viewpager-photos/" target="_blank" rel="external">http://www.alijava.com/viewpager-photos/</a> 转载请注明出处</p>
<h1 id="ViewPager展示图片"><a href="#ViewPager展示图片" class="headerlink" title="ViewPager展示图片"></a>ViewPager展示图片</h1><h2 id="xml-布局"><a href="#xml-布局" class="headerlink" title="xml 布局"></a>xml 布局</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;&gt;</div><div class="line"></div><div class="line">    &lt;!--ViewPager 热门文章图片展示--&gt;</div><div class="line">    &lt;FrameLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;200dp&quot;</div><div class="line">        android:background=&quot;@color/gray_light&quot;&gt;</div><div class="line"></div><div class="line">        &lt;android.support.v4.view.ViewPager</div><div class="line">            android:id=&quot;@+id/vp_hottest&quot;</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;match_parent&quot;</div><div class="line">            android:background=&quot;@color/colorPrimary&quot; /&gt;</div><div class="line"></div><div class="line">        &lt;LinearLayout</div><div class="line">            android:id=&quot;@+id/ll_hottest_indicator&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;20dp&quot;</div><div class="line">            android:layout_gravity=&quot;bottom|right&quot;</div><div class="line">            android:layout_marginBottom=&quot;5dp&quot;</div><div class="line">            android:layout_marginRight=&quot;10dp&quot;</div><div class="line">            android:layout_marginTop=&quot;5dp&quot;</div><div class="line">            android:gravity=&quot;center&quot;</div><div class="line">            android:orientation=&quot;horizontal&quot; /&gt;</div><div class="line">    &lt;/FrameLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>FrameLayout里面包含了ViewPager和LinearLayout，ViewPager 显示图片，LinearLayout是小圆点指示器区域，标记现在滑到哪张图片。</p>
<p>查看 xml 预览图，由于没有图片内容，当前只显示出红色矩形区域。</p>
<p><img src="http://img.blog.csdn.net/20160116201446285" width="20%" height="20%" alt="http://blog.csdn.net/never_cxb" align="center"></p>
<h2 id="新建javabean"><a href="#新建javabean" class="headerlink" title="新建javabean"></a>新建javabean</h2><p>首页的图片地址是新闻的一个属性，我们新建一个ItemArticle类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public class ItemArticle &#123;</div><div class="line">	// 新闻的 id</div><div class="line">    private int index;</div><div class="line">    // 新闻里的图片 url</div><div class="line">    private String imageUrl;</div><div class="line"></div><div class="line">    public ItemArticle(int index, String imageUrl) &#123;</div><div class="line">        this.index = index;</div><div class="line">        this.imageUrl = imageUrl;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public int getIndex() &#123;</div><div class="line">        return index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setIndex(int index) &#123;</div><div class="line">        this.index = index;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getImageUrl() &#123;</div><div class="line">        return imageUrl;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setImageUrl(String imageUrl) &#123;</div><div class="line">        this.imageUrl = imageUrl;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="适配器-PagerAdapter"><a href="#适配器-PagerAdapter" class="headerlink" title="适配器  PagerAdapter"></a>适配器  PagerAdapter</h2><p>继承自 <code>android.support.v4.view.PagerAdapter</code>，复写4个方法</p>
<ul>
<li>instantiateItem(ViewGroup, int)</li>
<li>destroyItem(ViewGroup, int, Object)</li>
<li>getCount()</li>
<li>isViewFromObject(View, Object)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">public class HeaderAdapter extends PagerAdapter &#123;</div><div class="line">    private static final String LOG = &quot;NEWS_LOG&quot;;</div><div class="line"></div><div class="line">    private Activity context;</div><div class="line">    private List&lt;ItemArticle&gt; articles;</div><div class="line">    private List&lt;SimpleDraweeView&gt; images = new ArrayList&lt;SimpleDraweeView&gt;();</div><div class="line"></div><div class="line"></div><div class="line">    public HeaderAdapter(Activity context, List&lt;ItemArticle&gt; articles) &#123;</div><div class="line">        this.context = context;</div><div class="line">        if (articles == null || articles.size() == 0) &#123;</div><div class="line">            this.articles = new ArrayList&lt;&gt;();</div><div class="line">        &#125; else &#123;</div><div class="line">            this.articles = articles;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; articles.size(); i++) &#123;</div><div class="line">            SimpleDraweeView image = new SimpleDraweeView(context);</div><div class="line">            Uri uri = Uri.parse(articles.get(i).getImageUrl());</div><div class="line">            image.setImageURI(uri);</div><div class="line">            images.add(image);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Object instantiateItem(ViewGroup container, int position) &#123;</div><div class="line">        container.addView(images.get(position));</div><div class="line">        return images.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void destroyItem(ViewGroup container, int position, Object object) &#123;</div><div class="line">        container.removeView(images.get(position));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getCount() &#123;</div><div class="line">        return articles.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean isViewFromObject(View view, Object object) &#123;</div><div class="line">        Log.i(LOG, &quot;in isViewFromObject view: &quot; + view + &quot; object: &quot;</div><div class="line">                + object + &quot; equal: &quot; + (view == (View) object));</div><div class="line">        return view == (View) object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="深入解析-isViewFromObject-方法"><a href="#深入解析-isViewFromObject-方法" class="headerlink" title="深入解析 isViewFromObject 方法"></a>深入解析 isViewFromObject 方法</h2><p>isViewFromObject(View view, Object object)的通用写法是return view == (View) object;<br>其中(View) object可根据具体情形替换成LinearLayout等等。</p>
<p>查看 ViewPager 源代码（<a href="https://code.google.com/p/openintents/source/browse/trunk/compatibility/AndroidSupportV2/src/android/support/v2/view/ViewPager.java?r=3488" target="_blank" rel="external">戳这里</a>）</p>
<p><code>isViewFromObject</code>是在infoForChild里被调用的，而且在该方法内会被调用mItems.size()次，mItems.size()是 ViewPager 里面图片的个数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">static class ItemInfo &#123;</div><div class="line">    Object object;</div><div class="line">    int position;</div><div class="line">    boolean scrolling;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private final ArrayList&lt;ItemInfo&gt; mItems = new ArrayList&lt;ItemInfo&gt;();</div><div class="line"></div><div class="line">ItemInfo infoForChild(View child) &#123;</div><div class="line">    for (int i=0; i&lt;mItems.size(); i++) &#123;</div><div class="line">        ItemInfo ii = mItems.get(i);</div><div class="line">        if (mAdapter.isViewFromObject(child, ii.object)) &#123;</div><div class="line">            return ii;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ViewPager里面用了一个mItems 存储每个page的信息(ItemInfo)，当界面要展示或者发生变化时，需要依据page的当前信息来调整，但此时只能通过view来查找，遍历mItems通过比较view和object来找到对应的ItemInfo。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Log.i(LOG, &quot;in isViewFromObject view: &quot; + view + &quot; object: &quot;</div><div class="line">        + object + &quot; equal: &quot; + (view == (View) object));</div></pre></td></tr></table></figure>
<p>所以我们如果打印出 Log 的话，会看到isViewFromObject()被调用多次，只有1次返回 true （表示找到了对应的ItemInfo），其他返回 false。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">01-17 10:15:21.207 I/NEWS_LOG﹕ in isViewFromObject </div><div class="line">view: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">object: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">equal: false</div><div class="line"></div><div class="line">01-17 10:15:21.207 I/NEWS_LOG﹕ in isViewFromObject </div><div class="line">view: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">object: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">equal: false</div><div class="line"></div><div class="line">01-17 10:15:21.207 I/NEWS_LOG﹕ in isViewFromObject </div><div class="line">view: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">object: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">equal: false</div><div class="line"></div><div class="line">01-17 10:15:21.207 I/NEWS_LOG﹕ in isViewFromObject </div><div class="line">view: SimpleDraweeView&#123;holder=DraweeHolder&#123;...&#125; </div><div class="line">object: SimpleDraweeView&#123;....&#125;&#125; </div><div class="line">equal: true</div></pre></td></tr></table></figure>
<h1 id="底部小圆点指示器"><a href="#底部小圆点指示器" class="headerlink" title="底部小圆点指示器"></a>底部小圆点指示器</h1><h2 id="图片增加小圆点"><a href="#图片增加小圆点" class="headerlink" title="图片增加小圆点"></a>图片增加小圆点</h2><p>轮播图片的底部都会加上小圆点，指示当前访问图片的位置。</p>
<p><img src="http://img.blog.csdn.net/20160117164201413" width="50%" height="50%" alt="http://blog.csdn.net/never_cxb" align="center"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">private ImageView[] mBottomImages;//底部只是当前页面的小圆点</div><div class="line"></div><div class="line"></div><div class="line">//创建底部指示位置的导航栏</div><div class="line">mBottomImages = new ImageView[headerArticles.size()];</div><div class="line"></div><div class="line">for (int i = 0; i &lt; mBottomImages.length; i++) &#123;</div><div class="line">    ImageView imageView = new ImageView(mAct);</div><div class="line">    LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(10, 10);</div><div class="line">    params.setMargins(5, 0, 5, 0);</div><div class="line">    imageView.setLayoutParams(params);</div><div class="line">    if (i == 0) &#123;</div><div class="line">        imageView.setBackgroundResource(R.drawable.indicator_select);</div><div class="line">    &#125; else &#123;</div><div class="line">        imageView.setBackgroundResource(R.drawable.indicator_not_select);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mBottomImages[i] = imageView;</div><div class="line">    //把指示作用的原点图片加入底部的视图中</div><div class="line">    llHottestIndicator.addView(mBottomImages[i]);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面这段代码是小圆点的初始步骤，最开始是第0张图片被选中，所以是第0张小圆点是蓝色，其他小圆点是灰色。</p>
<h2 id="addOnPageChangeListener小圆点动态变化"><a href="#addOnPageChangeListener小圆点动态变化" class="headerlink" title="addOnPageChangeListener小圆点动态变化"></a>addOnPageChangeListener小圆点动态变化</h2><p>切换图片的时候，小圆点也要随着改变，这需要利用ViewPager.OnPageChangeListener，主要是下面这个方法：</p>
<blockquote>
<p>public abstract void onPageSelected (int position)</p>
</blockquote>
<pre><code>This method will be invoked when a new page becomes selected. Animation is not necessarily complete.

Parameters
position    Position index of the new selected page.
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">vpHottest.addOnPageChangeListener(new ViewPager.OnPageChangeListener() &#123;	</div><div class="line">	//图片左右滑动时候，将当前页的圆点图片设为选中状态</div><div class="line">	@Override</div><div class="line">	public void onPageSelected(int position) &#123;</div><div class="line">	    // 一定几个图片，几个圆点，但注意是从0开始的</div><div class="line">	    int total = mBottomImages.length;</div><div class="line">	    for (int j = 0; j &lt; total; j++) &#123;</div><div class="line">	        if (j == position) &#123;</div><div class="line">	            mBottomImages[j].setBackgroundResource(R.drawable.indicator_select);</div><div class="line">	        &#125; else &#123;</div><div class="line">	            mBottomImages[j].setBackgroundResource(R.drawable.indicator_not_select);</div><div class="line">	        &#125;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	@Override</div><div class="line">	public void onPageScrolled(int i, float v, int i1) &#123;	</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onPageScrollStateChanged(int state) &#123;</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>onPageSelected()中，利用 for 循环，将当前选中位置对应的小圆点置为蓝色，其他小圆点置为灰色。</p>
<h2 id="自动播放"><a href="#自动播放" class="headerlink" title="自动播放"></a>自动播放</h2><p>先定义一个 Handler，在主线程里面更新 UI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//定时轮播图片，需要在主线程里面修改 UI</div><div class="line">private Handler mHandler = new Handler() &#123;</div><div class="line">    public void handleMessage(Message msg) &#123;</div><div class="line">        switch (msg.what) &#123;</div><div class="line">            case UPTATE_VIEWPAGER:</div><div class="line">                if (msg.arg1 != 0) &#123;</div><div class="line">                    vpHottest.setCurrentItem(msg.arg1);</div><div class="line">                &#125; else &#123;</div><div class="line">                    //false 当从末页调到首页是，不显示翻页动画效果，</div><div class="line">                    vpHottest.setCurrentItem(msg.arg1, false);</div><div class="line">                &#125;</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>利用 Timer 实现每隔 5s 向 Handler 发送message来更新图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// 设置自动轮播图片，5s后执行，周期是5s</div><div class="line">timer.schedule(new TimerTask() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        Message message = new Message();</div><div class="line">        message.what = UPTATE_VIEWPAGER;</div><div class="line">        if (autoCurrIndex == headerArticles.size() - 1) &#123;</div><div class="line">            autoCurrIndex = -1;</div><div class="line">        &#125;</div><div class="line">        message.arg1 = autoCurrIndex + 1;</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;, 5000, 5000);</div></pre></td></tr></table></figure>
<p>为了使得滑到最后一页后能滑到首页，我们对于<code>autoCurrIndex == headerArticles.size() - 1</code>进行了处理。</p>
<h1 id="一些知识点"><a href="#一些知识点" class="headerlink" title="一些知识点"></a>一些知识点</h1><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>基于上面的分析，我们实现了自动轮播图片</p>
<p><img src="http://img.blog.csdn.net/20160117172421660" width="40%" height="40%" alt="http://blog.csdn.net/never_cxb" align="center"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div></pre></td><td class="code"><pre><div class="line">public class MasterArticleFragment extends Fragment &#123;</div><div class="line"></div><div class="line">    private static final String ARTICLE_LATEST_PARAM = &quot;param&quot;;</div><div class="line"></div><div class="line">    private static final int UPTATE_VIEWPAGER = 0;</div><div class="line"></div><div class="line">    //轮播的最热新闻图片</div><div class="line">    @InjectView(R.id.vp_hottest)</div><div class="line">    ViewPager vpHottest;</div><div class="line">    //轮播图片下面的小圆点</div><div class="line">    @InjectView(R.id.ll_hottest_indicator)</div><div class="line">    LinearLayout llHottestIndicator;</div><div class="line"></div><div class="line">    //存储的参数</div><div class="line">    private String mParam;</div><div class="line"></div><div class="line">    //获取 fragment 依赖的 Activity，方便使用 Context</div><div class="line">    private Activity mAct;</div><div class="line"></div><div class="line">    //设置当前 第几个图片 被选中</div><div class="line">    private int autoCurrIndex = 0;</div><div class="line">    </div><div class="line">    private ImageView[] mBottomImages;//底部只是当前页面的小圆点 </div><div class="line">    </div><div class="line">    private Timer timer = new Timer(); //为了方便取消定时轮播，将 Timer 设为全局</div><div class="line"></div><div class="line">    //定时轮播图片，需要在主线程里面修改 UI</div><div class="line">    private Handler mHandler = new Handler() &#123;</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            switch (msg.what) &#123;</div><div class="line">                case UPTATE_VIEWPAGER:</div><div class="line">                    if (msg.arg1 != 0) &#123;</div><div class="line">                        vpHottest.setCurrentItem(msg.arg1);</div><div class="line">                    &#125; else &#123;</div><div class="line">                        //false 当从末页调到首页是，不显示翻页动画效果，</div><div class="line">                        vpHottest.setCurrentItem(msg.arg1, false);</div><div class="line">                    &#125;</div><div class="line">                    break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    public static MasterArticleFragment newInstance(String param) &#123;</div><div class="line">        MasterArticleFragment fragment = new MasterArticleFragment();</div><div class="line">        Bundle args = new Bundle();</div><div class="line">        args.putString(ARTICLE_LATEST_PARAM, param);</div><div class="line">        fragment.setArguments(args);</div><div class="line">        return fragment;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onCreate(@Nullable Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        if (savedInstanceState != null) &#123;</div><div class="line">            mParam = savedInstanceState.getString(ARTICLE_LATEST_PARAM);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Nullable</div><div class="line">    @Override</div><div class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) &#123;</div><div class="line"></div><div class="line">        View view = inflater.inflate(R.layout.fragment_one_master, container, false);</div><div class="line">        mAct = getActivity();</div><div class="line">        ButterKnife.inject(this, view);</div><div class="line">        return view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onActivityCreated(@Nullable Bundle savedInstanceState) &#123;</div><div class="line">        super.onActivityCreated(savedInstanceState);</div><div class="line">        new ImageTask().execute();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onDestroyView() &#123;</div><div class="line">        super.onDestroyView();</div><div class="line">        ButterKnife.reset(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    private void setUpViewPager(final List&lt;ItemArticle&gt; headerArticles) &#123;</div><div class="line">        HeaderAdapter imageAdapter = new HeaderAdapter(mAct, headerArticles);</div><div class="line">        vpHottest.setAdapter(imageAdapter);</div><div class="line"></div><div class="line">        //创建底部指示位置的导航栏</div><div class="line">        mBottomImages = new ImageView[headerArticles.size()];</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; mBottomImages.length; i++) &#123;</div><div class="line">            ImageView imageView = new ImageView(mAct);</div><div class="line">            LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(10, 10);</div><div class="line">            params.setMargins(5, 0, 5, 0);</div><div class="line">            imageView.setLayoutParams(params);</div><div class="line">            if (i == 0) &#123;</div><div class="line">                imageView.setBackgroundResource(R.drawable.indicator_select);</div><div class="line">            &#125; else &#123;</div><div class="line">                imageView.setBackgroundResource(R.drawable.indicator_not_select);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            mBottomImages[i] = imageView;</div><div class="line">            //把指示作用的原点图片加入底部的视图中</div><div class="line">            llHottestIndicator.addView(mBottomImages[i]);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        vpHottest.addOnPageChangeListener(new ViewPager.OnPageChangeListener() &#123;</div><div class="line"></div><div class="line">              //图片左右滑动时候，将当前页的圆点图片设为选中状态</div><div class="line">              @Override</div><div class="line">              public void onPageSelected(int position) &#123;</div><div class="line">                  // 一定几个图片，几个圆点，但注意是从0开始的</div><div class="line">                  int total = mBottomImages.length;</div><div class="line">                  for (int j = 0; j &lt; total; j++) &#123;</div><div class="line">                      if (j == position) &#123;</div><div class="line">                          mBottomImages[j].setBackgroundResource(R.drawable.indicator_select);</div><div class="line">                      &#125; else &#123;</div><div class="line">                          mBottomImages[j].setBackgroundResource(R.drawable.indicator_not_select);</div><div class="line">                      &#125;</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">                  //设置全局变量，currentIndex为选中图标的 index</div><div class="line">                  autoCurrIndex = position;</div><div class="line">              &#125;</div><div class="line"></div><div class="line">              @Override</div><div class="line">              public void onPageScrolled(int i, float v, int i1) &#123;</div><div class="line">              &#125;</div><div class="line"></div><div class="line">              @Override</div><div class="line">              public void onPageScrollStateChanged(int state) &#123;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">        );</div><div class="line"></div><div class="line">		// 设置自动轮播图片，5s后执行，周期是5s</div><div class="line">		timer.schedule(new TimerTask() &#123;</div><div class="line">		    @Override</div><div class="line">		    public void run() &#123;</div><div class="line">		        Message message = new Message();</div><div class="line">		        message.what = UPTATE_VIEWPAGER;</div><div class="line">		        if (autoCurrIndex == headerArticles.size() - 1) &#123;</div><div class="line">		            autoCurrIndex = -1;</div><div class="line">		        &#125;</div><div class="line">		        message.arg1 = autoCurrIndex + 1;</div><div class="line">		        mHandler.sendMessage(message);</div><div class="line">		    &#125;</div><div class="line">		&#125;, 5000, 5000);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    class ImageTask extends AsyncTask&lt;String, Void, List&lt;ItemArticle&gt;&gt; &#123;</div><div class="line">        @Override</div><div class="line">        protected List&lt;ItemArticle&gt; doInBackground(String... params) &#123;</div><div class="line">            List&lt;ItemArticle&gt; articles = new ArrayList&lt;ItemArticle&gt;();</div><div class="line">            articles.add(</div><div class="line">                    new ItemArticle(1123, &quot;http://***20151231105648_11790.jpg&quot;));</div><div class="line">            articles.add(</div><div class="line">                    new ItemArticle(1123, &quot;http://***20151230152544_36663.jpg&quot;));</div><div class="line">            articles.add(</div><div class="line">                    new ItemArticle(1123, &quot;http://***20151229204329_75030.jpg&quot;));</div><div class="line">            articles.add(</div><div class="line">                    new ItemArticle(1123, &quot;http://***20151221151031_36136.jpg&quot;));</div><div class="line">            return articles;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        protected void onPostExecute(List&lt;ItemArticle&gt; articles) &#123;</div><div class="line">            //这儿的 是 url 的集合</div><div class="line">            super.onPostExecute(articles);</div><div class="line">            setUpViewPager(articles);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="schedule和scheduleAtFixedRate方法"><a href="#schedule和scheduleAtFixedRate方法" class="headerlink" title="schedule和scheduleAtFixedRate方法"></a>schedule和scheduleAtFixedRate方法</h2><p>（1）schedule方法：下一次执行时间相对于 上一次 实际<strong>执行完成</strong>的时间点 ，因此执行时间会不断延后。保持间隔时间的稳定<br>（2）scheduleAtFixedRate方法：下一次执行时间相对于上一次<strong>开始的 时间点</strong> ，因此执行时间不会延后，<strong>存在并发性</strong> 。保持执行频率的稳定。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><p>LoremPixel 图片资源网站，随机生成图片 <a href="http://lorempixel.com/" target="_blank" rel="external">http://lorempixel.com/</a></p>
</li>
<li><p>Android Image Slideshow using ViewPager with PagerAdapter <a href="http://codetheory.in/android-image-slideshow-using-viewpager-pageradapter/" target="_blank" rel="external">http://codetheory.in/android-image-slideshow-using-viewpager-pageradapter/</a></p>
</li>
<li><p>安卓PagerAdapter中的isViewFromObject()方法有什么用？ <a href="http://segmentfault.com/q/1010000000484617" target="_blank" rel="external">http://segmentfault.com/q/1010000000484617</a></p>
</li>
<li><p>Timer的schedule和scheduleAtFixedRate方法的区别解析 <a href="http://blog.csdn.net/gtuu0123/article/details/6040159" target="_blank" rel="external">http://blog.csdn.net/gtuu0123/article/details/6040159</a> </p>
</li>
</ul>
<ul>
<li><p>Android 仿首页广告轮播效果 <a href="http://blog.csdn.net/xiyou_android/article/details/45566129" target="_blank" rel="external">http://blog.csdn.net/xiyou_android/article/details/45566129</a></p>
</li>
<li><p>Android Material Design之Toolbar与Palette实践 <a href="http://blog.csdn.net/bbld_/article/details/41439715" target="_blank" rel="external">http://blog.csdn.net/bbld_/article/details/41439715</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/24/viewpager-photos/" data-id="ciyyds56l001hbuxba67dcmwm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/25/android-interview/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android程序员面试常见知识点
        
      </div>
    </a>
  
  
    <a href="/2016/08/23/material-setting/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android实现Material Design风格的设置页面（滑动开关控件）</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MaterialDesign/">MaterialDesign</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/七牛/">七牛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令行/">命令行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序/">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数组/">数组</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 18px;">Android</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MaterialDesign/" style="font-size: 10px;">MaterialDesign</a> <a href="/tags/Python/" style="font-size: 12px;">Python</a> <a href="/tags/七牛/" style="font-size: 10px;">七牛</a> <a href="/tags/命令行/" style="font-size: 10px;">命令行</a> <a href="/tags/工具/" style="font-size: 14px;">工具</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/数组/" style="font-size: 10px;">数组</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/网络/" style="font-size: 10px;">网络</a> <a href="/tags/面试/" style="font-size: 16px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/09/04/hexo-tips/">从 CSDN 博客迁移到个人 Hexo 站点的一点坑</a>
          </li>
        
          <li>
            <a href="/2017/02/09/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2016/11/25/campus-interview/">2017互联网校园招聘的一些面试题</a>
          </li>
        
          <li>
            <a href="/2016/10/03/javac-error/">javac、javap命令行执行 java 程序的一点小坑</a>
          </li>
        
          <li>
            <a href="/2016/10/02/sort-summary/">经典排序算法总结--冒泡、快排、插入、希尔、归并、选择</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>